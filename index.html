<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>Panasonic ¬∑ Estoque & Concorr√™ncia</title>
    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase (compat) + jsPDF + autoTable -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* pequeno ajuste para azul Panasonic */
        .bg-panasonic { background-color: #004c97; }
        .border-panasonic { border-color: #004c97; }
        .text-panasonic { color: #004c97; }
        .table-scroll { overflow-x: auto; display: block; white-space: nowrap; }
        .product-table th { background-color: #f0f4fa; }
        input:focus { outline: 2px solid #004c97; outline-offset: 1px; }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased p-4 md:p-6">

    <!-- FIREBASE CONFIG (substitua pelos seus dados) -->
    <script>
        // üî• COLOQUE AQUI SUAS CREDENCIAIS DO FIREBASE üî•
        const firebaseConfig = {
  apiKey: "AIzaSyAyfJtCTZdIt5IUG5BZNmDd9UiaKBIyKZY",
  authDomain: "arenadeconhecimento.firebaseapp.com",
  databaseURL: "https://arenadeconhecimento-default-rtdb.firebaseio.com",
  projectId: "arenadeconhecimento",
  storageBucket: "arenadeconhecimento.firebasestorage.app",
  messagingSenderId: "889132093510",
  appId: "1:889132093510:web:d9d7ddd92fec82d247ba47"
};
        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const concorrentesRef = db.ref('concorrentes');
    </script>

    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl p-4 md:p-6 border-t-4 border-panasonic">
        
        <!-- cabe√ßalho com identifica√ß√£o -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">üì¶ REVENDA</label>
                <input type="text" id="revenda" placeholder="Nome da revenda" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:border-panasonic">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">üìÖ DATA</label>
                <input type="date" id="data" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:border-panasonic">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">üë§ CONSULTOR</label>
                <input type="text" id="consultor" placeholder="Seu nome" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:border-panasonic">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">üë• COORDENADOR</label>
                <input type="text" id="coordenador" placeholder="Nome do coordenador" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:border-panasonic">
            </div>
        </div>

        <!-- datalist global para concorrentes (sugest√µes colaborativas) -->
        <datalist id="listaConcorrentes"></datalist>

        <!-- abas por categoria (simples com scroll) -->
        <div class="mb-4 flex flex-wrap gap-2 border-b border-gray-200">
            <span class="text-lg font-bold text-panasonic mr-4">CATEGORIAS</span>
            <a href="#refrigerador" class="tab-link text-sm font-medium px-3 py-2 text-gray-600 hover:text-panasonic">Refrigerador</a>
            <a href="#lavadora" class="tab-link text-sm font-medium px-3 py-2 text-gray-600 hover:text-panasonic">Lavadora</a>
            <a href="#microondas" class="tab-link text-sm font-medium px-3 py-2 text-gray-600 hover:text-panasonic">Microondas</a>
            <a href="#forno" class="tab-link text-sm font-medium px-3 py-2 text-gray-600 hover:text-panasonic">Forno/Cooktop</a>
            <a href="#pessoais" class="tab-link text-sm font-medium px-3 py-2 text-gray-600 hover:text-panasonic">Cuidados Pessoais</a>
        </div>

        <!-- container dos produtos (gerado via JS) -->
        <div id="produtos-container" class="space-y-8"></div>

        <!-- observa√ß√µes -->
        <div class="mt-8">
            <label class="block text-sm font-medium text-gray-700 mb-2">üìù OBSERVA√á√ïES</label>
            <textarea id="obs" rows="3" placeholder="Observa√ß√µes gerais, promo√ß√µes, etc..." class="w-full border border-gray-300 rounded-lg px-4 py-2"></textarea>
        </div>

        <!-- barra de a√ß√µes -->
        <div class="mt-8 flex flex-wrap gap-3 justify-end border-t pt-6">
            <button id="salvarRascunho" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-5 py-2 rounded-full shadow-sm flex items-center gap-2 transition">
                üíæ Salvar rascunho local
            </button>
            <button id="carregarRascunho" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-5 py-2 rounded-full shadow-sm flex items-center gap-2 transition">
                üìÇ Carregar rascunho
            </button>
            <button id="gerarWhatsApp" class="bg-green-600 hover:bg-green-700 text-white font-medium px-5 py-2 rounded-full shadow-sm flex items-center gap-2 transition">
                üì≤ WhatsApp
            </button>
            <button id="copiarTexto" class="bg-blue-100 hover:bg-blue-200 text-blue-800 font-medium px-5 py-2 rounded-full shadow-sm flex items-center gap-2 transition">
                üìã Copiar texto
            </button>
            <button id="gerarPDF" class="bg-panasonic hover:bg-blue-800 text-white font-medium px-5 py-2 rounded-full shadow-sm flex items-center gap-2 transition">
                üìÑ Gerar PDF azul
            </button>
        </div>
    </div>

    <script>
        (function() {
            // ---------- LISTA DE PRODUTOS POR CATEGORIA (conforme modelo) ----------
            const categorias = [
                { id: 'refrigerador', nome: 'REFRIGERADOR', modelos: [
                    "NR-BB71GVFB", "NR-BB71GV7B", "NR-BB71PVFX", "NR-BB71PV7X", "NR-BB71PV4B",
                    "NR-BB64PV1X", "NR-BB64PV1B", "NR-BB64PV2B", "NR-BB65GVFB", "NR-BB65GV7B",
                    "NR-BB41GV1B", "NR-BB41GV2B", "NR-BB41PV1T", "NR-BB41PV2T", "NR-BT56PD4W",
                    "NR-BT56PD4X", "NR-BT41PD1X", "NR-BT41PD1W", "NR-BT41PD2W", "NR-BT44PV3X",
                    "NR-BT44PV3B", "NR-BB71PV7X", "NR-DB69", "NR-DB99"
                ] },
                { id: 'lavadora', nome: 'LAVADORA', modelos: [
                    "NA-F120B1W", "NA-F120B1TA", "NA-F120B5G", "NA-F130B1W", "NA-F130B1T",
                    "NA-F140B1W", "NA-F150B1T", "NA-F150B1W", "NA-F160B6W", "NA-F170B7W",
                    "NA-F180D1WA", "NA-F180P7T", "NA-F190G1BW", "NA-F190G1B", "NA-S26MK1LB"
                ] },
                { id: 'microondas', nome: 'MICROONDAS', modelos: [
                    "NN-ST25L", "NN-ST27L", "NN-ST55L", "NN-ST65L", "NN-GT68L",
                    "NN-CD89", "NN-ST67L", "NN-ST61N", "NN-ST66N", "NN-ST67L"
                ] },
                { id: 'forno', nome: 'FORNO / COOKTOP / COZINHA', modelos: [
                    "NN-GB68QBRUK", "NN-GB68QSRUK", "HL-CX668SRPK", "HL-CX672BRPK", "NP-6M2FTKBRP",
                    "NP-6M1MBKBRP", "KY-W648CLRPK", "KY-T937XLRPK", "FV-6HSUB2", "FV-9HSDB2"
                ] },
                { id: 'pessoais', nome: 'CUIDADOS PESSOAIS', modelos: [
                    "ER-GK20", "ER-GN30", "ER-GN25", "ER-GK80", "ER-GB80",
                    "ER-389X", "EW-DJ10", "ER389X"
                ] }
            ];

            // ---------- estado dos concorrentes (colaborativo) ----------
            let concorrentesSet = new Set();
            const datalist = document.getElementById('listaConcorrentes');

            // carrega concorrentes do Firebase e atualiza datalist
            function carregarConcorrentes() {
                concorrentesRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    concorrentesSet.clear();
                    if (data) {
                        Object.keys(data).forEach(key => concorrentesSet.add(key));
                    }
                    atualizarDatalist();
                });
            }

            function atualizarDatalist() {
                datalist.innerHTML = '';
                concorrentesSet.forEach(conc => {
                    const opt = document.createElement('option');
                    opt.value = conc;
                    datalist.appendChild(opt);
                });
            }

            // adiciona novo concorrente ao Firebase (se n√£o existir)
            function adicionarConcorrente(valor) {
                if (!valor || typeof valor !== 'string') return;
                valor = valor.trim();
                if (valor === '' || concorrentesSet.has(valor)) return;
                // usa o pr√≥prio valor como chave (escape para evitar caracteres inv√°lidos)
                const safeKey = valor.replace(/[.#$\[\]]/g, '_');
                concorrentesRef.child(safeKey).set(true);
            }

            // ---------- gerar HTML das tabelas ----------
            const container = document.getElementById('produtos-container');
            function renderizarTabelas() {
                let html = '';
                categorias.forEach(cat => {
                    html += `<div id="${cat.id}" class="bg-white rounded-xl border border-gray-200 overflow-hidden">`;
                    html += `<div class="bg-panasonic px-4 py-2 text-white font-bold text-lg">${cat.nome}</div>`;
                    html += `<div class="table-scroll"><table class="min-w-full divide-y divide-gray-200 product-table">`;
                    // cabe√ßalho
                    html += `<thead class="bg-gray-100"><tr>`;
                    html += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">PANASONIC</th>`;
                    html += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">PRE√áO (R$)</th>`;
                    html += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">CD</th>`;
                    html += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">CONCORRENTE (produto)</th>`;
                    html += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">PRE√áO CONCORRENTE (R$)</th>`;
                    html += `</tr></thead><tbody class="bg-white divide-y divide-gray-200">`;
                    
                    cat.modelos.forEach(modelo => {
                        html += `<tr class="hover:bg-gray-50">`;
                        html += `<td class="px-3 py-2 whitespace-nowrap font-mono text-sm">${modelo}</td>`;
                        html += `<td class="px-3 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="preco" placeholder="0,00" class="w-24 border border-gray-300 rounded px-2 py-1 text-sm"></td>`;
                        html += `<td class="px-3 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="cd" placeholder="CD" class="w-16 border border-gray-300 rounded px-2 py-1 text-sm"></td>`;
                        html += `<td class="px-3 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="concorrente" list="listaConcorrentes" placeholder="Marca/modelo" class="w-40 border border-gray-300 rounded px-2 py-1 text-sm concorrente-input"></td>`;
                        html += `<td class="px-3 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="precoConcorrente" placeholder="0,00" class="w-24 border border-gray-300 rounded px-2 py-1 text-sm"></td>`;
                        html += `</tr>`;
                    });
                    html += `</tbody></table></div></div>`;
                });
                container.innerHTML = html;

                // anexar eventos de blur nos campos concorrente para salvar no Firebase
                document.querySelectorAll('.concorrente-input').forEach(inp => {
                    inp.addEventListener('blur', (e) => {
                        const valor = e.target.value;
                        if (valor) adicionarConcorrente(valor);
                    });
                });
            }

            // ---------- data atual autom√°tica ----------
            function preencherDataHoje() {
                const hoje = new Date();
                const ano = hoje.getFullYear();
                const mes = String(hoje.getMonth() + 1).padStart(2, '0');
                const dia = String(hoje.getDate()).padStart(2, '0');
                document.getElementById('data').value = `${ano}-${mes}-${dia}`;
            }

            // ---------- salvar rascunho no localStorage ----------
            function salvarRascunho() {
                const rascunho = {
                    revenda: document.getElementById('revenda').value,
                    data: document.getElementById('data').value,
                    consultor: document.getElementById('consultor').value,
                    coordenador: document.getElementById('coordenador').value,
                    obs: document.getElementById('obs').value,
                    produtos: []
                };
                document.querySelectorAll('#produtos-container input[data-modelo]').forEach(inp => {
                    const categoria = inp.dataset.categoria;
                    const modelo = inp.dataset.modelo;
                    const campo = inp.dataset.campo;
                    const valor = inp.value;
                    let entry = rascunho.produtos.find(p => p.categoria === categoria && p.modelo === modelo);
                    if (!entry) {
                        entry = { categoria, modelo, preco: '', cd: '', concorrente: '', precoConcorrente: '' };
                        rascunho.produtos.push(entry);
                    }
                    entry[campo] = valor;
                });
                localStorage.setItem('rascunhoEstoque', JSON.stringify(rascunho));
                alert('‚úÖ Rascunho salvo no navegador');
            }

            function carregarRascunho() {
                const saved = localStorage.getItem('rascunhoEstoque');
                if (!saved) { alert('Nenhum rascunho encontrado'); return; }
                try {
                    const rascunho = JSON.parse(saved);
                    document.getElementById('revenda').value = rascunho.revenda || '';
                    document.getElementById('data').value = rascunho.data || '';
                    document.getElementById('consultor').value = rascunho.consultor || '';
                    document.getElementById('coordenador').value = rascunho.coordenador || '';
                    document.getElementById('obs').value = rascunho.obs || '';
                    
                    rascunho.produtos.forEach(p => {
                        // preencher inputs correspondentes
                        const precoInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="preco"]`);
                        if (precoInp) precoInp.value = p.preco || '';
                        const cdInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="cd"]`);
                        if (cdInp) cdInp.value = p.cd || '';
                        const concInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="concorrente"]`);
                        if (concInp) concInp.value = p.concorrente || '';
                        const precoConcInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="precoConcorrente"]`);
                        if (precoConcInp) precoConcInp.value = p.precoConcorrente || '';
                    });
                    alert('‚úÖ Rascunho carregado');
                } catch (e) {
                    alert('Erro ao carregar rascunho');
                }
            }

            // ---------- gerar texto para WhatsApp ----------
            function gerarTextoCompleto() {
                let texto = '*ESTOQUE DA REVENDA:*\n';
                texto += '------------------------------------------------\n';
                texto += `*REVENDA:* ${document.getElementById('revenda').value || '________________'}\n`;
                texto += `*DATA:* ${document.getElementById('data').value || '____-__-__'}\n`;
                texto += `*CONSULTOR:* ${document.getElementById('consultor').value || '________________'}\n`;
                texto += `*COORDENADOR:* ${document.getElementById('coordenador').value || '________________'}\n`;
                texto += '________________________________________________\n';

                categorias.forEach(cat => {
                    texto += `\n*${cat.nome}:*\n`;
                    texto += '------------------------------------------------\n';
                    texto += '*PANASONIC:* | *PRE√áO:* | *CD:* | *CONCORRENTE:* | *PRE√áO CONCORRENTE:*\n';
                    cat.modelos.forEach(modelo => {
                        const preco = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="preco"]`)?.value || '';
                        const cd = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="cd"]`)?.value || '';
                        const conc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="concorrente"]`)?.value || '';
                        const precoConc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="precoConcorrente"]`)?.value || '';
                        if (preco || cd || conc || precoConc) { // s√≥ mostra linhas preenchidas? mas pode mostrar tudo
                            texto += `${modelo.padEnd(15)} R$${preco.padEnd(8)} ${cd.padEnd(6)} ${conc.padEnd(20)} R$${precoConc}\n`;
                        } else {
                            texto += `${modelo.padEnd(15)} R$          ${''.padEnd(6)} ${''.padEnd(20)} R$\n`;
                        }
                    });
                    texto += '________________________________________________\n';
                });
                texto += `\n*OBS:* ${document.getElementById('obs').value || ''}\n`;
                return texto;
            }

            // ---------- gerar PDF (azul Panasonic) ----------
            function gerarPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape', unit: 'mm', format: 'a4' });
                
                // cabe√ßalho azul
                doc.setFillColor(0, 76, 151); // #004c97
                doc.rect(0, 0, doc.internal.pageSize.width, 20, 'F');
                doc.setTextColor(255,255,255);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('PANASONIC - ESTOQUE REVENDA', 10, 14);
                
                // linha com dados
                doc.setTextColor(0,0,0);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                const rev = document.getElementById('revenda').value || '______________';
                const dat = document.getElementById('data').value || '____-__-__';
                const cons = document.getElementById('consultor').value || '______________';
                const coord = document.getElementById('coordenador').value || '______________';
                doc.text(`Revenda: ${rev}   Data: ${dat}   Consultor: ${cons}   Coord.: ${coord}`, 10, 28);

                let yPos = 35;
                const pageHeight = doc.internal.pageSize.height;
                
                categorias.forEach((cat, idx) => {
                    // verificar espa√ßo
                    if (yPos > pageHeight - 40) {
                        doc.addPage();
                        yPos = 20;
                    }
                    // t√≠tulo da categoria
                    doc.setFillColor(0, 76, 151);
                    doc.setTextColor(255,255,255);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(11);
                    doc.text(cat.nome, 10, yPos-2);
                    doc.setTextColor(0,0,0);
                    
                    // montar dados da tabela
                    const headers = [['PANASONIC', 'PRE√áO (R$)', 'CD', 'CONCORRENTE', 'PRE√áO CONCORRENTE (R$)']];
                    const body = [];
                    cat.modelos.forEach(modelo => {
                        const preco = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="preco"]`)?.value || '';
                        const cd = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="cd"]`)?.value || '';
                        const conc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="concorrente"]`)?.value || '';
                        const precoConc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="precoConcorrente"]`)?.value || '';
                        body.push([modelo, preco, cd, conc, precoConc]);
                    });

                    doc.autoTable({
                        head: headers,
                        body: body,
                        startY: yPos,
                        margin: { left: 10, right: 10 },
                        theme: 'grid',
                        headStyles: { fillColor: [0, 76, 151], textColor: 255, fontStyle: 'bold' },
                        alternateRowStyles: { fillColor: [240, 244, 250] },
                        columnStyles: {
                            0: { cellWidth: 40 },
                            1: { cellWidth: 20 },
                            2: { cellWidth: 15 },
                            3: { cellWidth: 45 },
                            4: { cellWidth: 25 }
                        },
                        didDrawPage: (data) => { yPos = data.cursor.y + 5; }
                    });
                    yPos = doc.lastAutoTable.finalY + 8;
                });

                // observa√ß√µes
                const obs = document.getElementById('obs').value;
                if (obs) {
                    doc.setFontSize(10);
                    doc.setTextColor(80,80,80);
                    doc.text(`Obs: ${obs}`, 10, yPos);
                }
                doc.save('estoque_panasonic.pdf');
            }

            // ---------- copiar texto ----------
            function copiarTexto() {
                const texto = gerarTextoCompleto();
                navigator.clipboard.writeText(texto).then(() => {
                    alert('‚úÖ Texto copiado para a √°rea de transfer√™ncia');
                }).catch(() => {
                    prompt('Copie manualmente:', texto);
                });
            }

            // ---------- abrir WhatsApp ----------
            function abrirWhatsApp() {
                const texto = encodeURIComponent(gerarTextoCompleto());
                window.open(`https://api.whatsapp.com/send?text=${texto}`, '_blank');
            }

            // ---------- inicializa√ß√£o ----------
            window.addEventListener('DOMContentLoaded', () => {
                renderizarTabelas();
                preencherDataHoje();
                carregarConcorrentes(); // ouvinte Firebase

                // bot√µes
                document.getElementById('salvarRascunho').addEventListener('click', salvarRascunho);
                document.getElementById('carregarRascunho').addEventListener('click', carregarRascunho);
                document.getElementById('gerarWhatsApp').addEventListener('click', abrirWhatsApp);
                document.getElementById('copiarTexto').addEventListener('click', copiarTexto);
                document.getElementById('gerarPDF').addEventListener('click', gerarPDF);

                // suavizar links de categoria
                document.querySelectorAll('.tab-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const id = link.getAttribute('href').substring(1);
                        document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                });
            });

        })();
    </script>

    <!-- instru√ß√µes r√°pidas -->
    <div class="max-w-7xl mx-auto mt-4 text-xs text-gray-400 flex justify-between">
        <span>‚úÖ Preencha os pre√ßos e CD. Ao digitar concorrente, ele √© salvo no Firebase e sugerido para todos.</span>
        <span>üé® Azul Panasonic | colaborativo em tempo real</span>
    </div>
</body>
</html>
