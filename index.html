<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domin√≥ Multiplayer</title>
    <!-- Carrega o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Carrega os SDKs do Firebase -->
    <script type="module">
        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged,
            signInWithCustomToken
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc, 
            onSnapshot,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configura√ß√£o do Firebase ---------------------------------------------
        
        // Configura√ß√£o do Firebase (hardcoded, conforme solicitado pelo usu√°rio)
        const firebaseConfig = {
          apiKey: "AIzaSyByyM8RvGNM5pyrQIQ7nCH6mmgYAIpq0bc",
          authDomain: "rifas-c414b.firebaseapp.com",
          databaseURL: "https://rifas-c414b-default-rtdb.firebaseio.com",
          projectId: "rifas-c414b",
          storageBucket: "rifas-c414b.firebasestorage.app",
          messagingSenderId: "770195193538",
          appId: "1:770195193538:web:48e585ac5661d27f3dc55b"
        };
        
        // Vari√°veis do ambiente do Canvas (necess√°rias para o caminho do DB e auth)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'domino-default';
        const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, auth, db;
        let currentUserId = null;
        let currentGameId = null;
        let localGameState = null;
        let gameUnsubscribe = null;

        // Elementos da UI
        let authScreen, gameScreen, modalOverlay, modalContent, gameIdInput, createGameBtn, joinGameBtn;
        let gameInfo, opponentHands, boardArea, playerHand, gameControls, boneyard, passTurnBtn, gameLog;
        let userIdDisplay;
        let toastContainer;

        // Estilos customizados para as pe√ßas com Material Design 3
        const style = document.createElement('style');
        style.textContent = `
            :root {
                --md-sys-color-primary: #6750A4;
                --md-sys-color-on-primary: #FFFFFF;
                --md-sys-color-primary-container: #EADDFF;
                --md-sys-color-on-primary-container: #21005D;
                --md-sys-color-secondary: #625B71;
                --md-sys-color-on-secondary: #FFFFFF;
                --md-sys-color-secondary-container: #E8DEF8;
                --md-sys-color-on-secondary-container: #1D192B;
                --md-sys-color-surface: #FFFBFE;
                --md-sys-color-on-surface: #1C1B1F;
                --md-sys-color-surface-variant: #E7E0EC;
                --md-sys-color-on-surface-variant: #49454F;
                --md-sys-color-outline: #79747E;
                --md-sys-color-error: #B3261E;
                --md-sys-color-on-error: #FFFFFF;
                --md-sys-color-error-container: #F9DEDC;
                --md-sys-color-on-error-container: #410E0B;
                --md-sys-color-success: #0D652D;
                --md-sys-color-on-success: #FFFFFF;
                --md-sys-color-success-container: #A5F3C1;
                --md-sys-color-on-success-container: #00210B;
            }
            
            .domino {
                width: 4rem;
                height: 8rem;
                border: 2px solid var(--md-sys-color-on-surface);
                background-color: var(--md-sys-color-surface);
                border-radius: 0.75rem;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                align-items: center;
                font-size: 1.875rem;
                font-weight: bold;
                color: var(--md-sys-color-on-surface);
                cursor: pointer;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                flex-shrink: 0; /* Impede que as pe√ßas encolham no flex */
            }
            
            .domino::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, rgba(103, 80, 164, 0.05) 0%, rgba(103, 80, 164, 0.1) 100%);
                z-index: 0;
            }
            
            .domino:hover {
                transform: translateY(-4px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            
            .domino-half {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                z-index: 1;
                position: relative;
            }
            
            .domino-divider {
                height: 2px;
                width: 90%;
                background-color: var(--md-sys-color-outline);
                opacity: 0.5;
                z-index: 1;
            }
            
            /* Pe√ßa deitada (para o tabuleiro) */
            .domino-board {
                width: 8rem;
                height: 4rem;
                flex-direction: row;
                margin: 0.5rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            
            .domino-board .domino-half {
                height: 100%;
            }
            
            .domino-board .domino-divider {
                width: 2px;
                height: 90%;
            }
            
            /* Pe√ßa "girada" (bucha/double) */
            .domino-board.double {
                width: 4rem;
                height: 8rem;
                flex-direction: column;
            }
            
            .domino-board.double .domino-divider {
                width: 90%;
                height: 2px;
            }
            
            /* M√£o do oponente */
            .domino-back {
                width: 2.5rem;
                height: 5rem;
                background: linear-gradient(135deg, var(--md-sys-color-primary) 0%, var(--md-sys-color-secondary) 100%);
                border: 2px solid var(--md-sys-color-primary);
                border-radius: 0.5rem;
                margin: 0.25rem;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
            }
            
            .domino-back::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
                animation: shine 3s infinite linear;
            }
            
            @keyframes shine {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }
            
            /* Material Design 3 Buttons */
            .m3-button {
                padding: 0.75rem 1.5rem;
                border-radius: 1.25rem;
                font-weight: 500;
                font-size: 0.875rem;
                letter-spacing: 0.025rem;
                text-transform: none;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                border: none;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            
            .m3-button-filled {
                background-color: var(--md-sys-color-primary);
                color: var(--md-sys-color-on-primary);
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            }
            
            .m3-button-filled:hover {
                background-color: var(--md-sys-color-primary);
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.3), 0 1px 3px 0 rgba(0, 0, 0, 0.2);
                transform: translateY(-2px);
            }
            
            .m3-button-outlined {
                background-color: transparent;
                color: var(--md-sys-color-primary);
                border: 1px solid var(--md-sys-color-outline);
            }
            
            .m3-button-outlined:hover {
                background-color: var(--md-sys-color-primary-container);
            }
            
            .m3-button-text {
                background-color: transparent;
                color: var(--md-sys-color-primary);
            }
            
            .m3-button-text:hover {
                background-color: var(--md-sys-color-primary-container);
            }
            
            /* Cards */
            .m3-card {
                background-color: var(--md-sys-color-surface);
                border-radius: 0.75rem;
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
                padding: 1.5rem;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .m3-card:hover {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            
            /* Chips */
            .m3-chip {
                display: inline-flex;
                align-items: center;
                padding: 0.25rem 0.75rem;
                border-radius: 0.5rem;
                background-color: var(--md-sys-color-surface-variant);
                color: var(--md-sys-color-on-surface-variant);
                font-size: 0.75rem;
                font-weight: 500;
            }
            
            /* Toast notifications */
            .toast {
                padding: 1rem 1.5rem;
                border-radius: 0.75rem;
                background-color: var(--md-sys-color-surface);
                color: var(--md-sys-color-on-surface);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                display: flex;
                align-items: center;
                gap: 0.5rem;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .toast.show {
                transform: translateX(0);
                opacity: 1;
            }
            
            .toast.success {
                border-left: 4px solid var(--md-sys-color-success);
            }
            
            .toast.error {
                border-left: 4px solid var(--md-sys-color-error);
            }
            
            .toast.warning {
                border-left: 4px solid #F59E0B;
            }
            
            /* Scrollbars Customizados (CSS POLISH) */
            #board-area::-webkit-scrollbar, 
            #player-hand::-webkit-scrollbar, 
            #game-log::-webkit-scrollbar {
                height: 8px;
                width: 8px;
            }
            
            #board-area::-webkit-scrollbar-thumb, 
            #player-hand::-webkit-scrollbar-thumb, 
            #game-log::-webkit-scrollbar-thumb {
                background-color: var(--md-sys-color-primary);
                border-radius: 4px;
            }
            
            #board-area::-webkit-scrollbar-track, 
            #player-hand::-webkit-scrollbar-track, 
            #game-log::-webkit-scrollbar-track {
                background-color: var(--md-sys-color-surface-variant);
                border-radius: 4px;
            }

            /* Responsive adjustments */
            @media (max-width: 768px) {
                .domino {
                    width: 3rem;
                    height: 6rem;
                    font-size: 1.5rem;
                }
                
                .domino-board {
                    width: 6rem;
                    height: 3rem;
                }
                
                .domino-back {
                    width: 2rem;
                    height: 4rem;
                }
            }
        `;
        document.head.appendChild(style);

        // --- Fun√ß√µes de UI (Modal, Toast) ---------------------------------------

        function showSpinner(message = "Carregando...") {
            modalOverlay.classList.remove('hidden');
            modalContent.innerHTML = `
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-white text-lg">${message}</p>
                </div>
            `;
        }

        function showModal(htmlContent) {
            modalOverlay.classList.remove('hidden');
            modalContent.innerHTML = htmlContent;
        }
        
        function hideModal() {
            modalOverlay.classList.add('hidden');
            modalContent.innerHTML = ''; // Limpa o conte√∫do
        }
        
        function getSpinnerHtml(message = "Carregando...") {
            return `
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p class="text-white text-lg">${message}</p>
                </div>
            `;
        }

        // Fun√ß√£o para mostrar notifica√ß√µes toast
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info';
            if (type === 'success') icon = 'check_circle';
            if (type === 'error') icon = 'error';
            if (type === 'warning') icon = 'warning';
            
            toast.innerHTML = `
                <span class="material-icons" style="font-size: 1.25rem;">${icon}</span>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toastContainer.contains(toast)) {
                        toastContainer.removeChild(toast);
                    }
                }, 300);
            }, duration);
        }

        // --- Fun√ß√µes Principais --------------------------------------------------

        window.onload = () => {
            // Inicializar Firebase
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug'); // Para logs de debug do Firestore
                
                // Obter refer√™ncias da UI
                authScreen = document.getElementById('auth-screen');
                gameScreen = document.getElementById('game-screen');
                modalOverlay = document.getElementById('modal-overlay');
                modalContent = document.getElementById('modal-content');
                gameIdInput = document.getElementById('game-id-input');
                createGameBtn = document.getElementById('create-game-btn');
                joinGameBtn = document.getElementById('join-game-btn');
                gameInfo = document.getElementById('game-info');
                opponentHands = document.getElementById('opponent-hands');
                boardArea = document.getElementById('board-area');
                playerHand = document.getElementById('player-hand');
                gameControls = document.getElementById('game-controls');
                boneyard = document.getElementById('boneyard');
                passTurnBtn = document.getElementById('pass-turn-btn');
                gameLog = document.getElementById('game-log');
                userIdDisplay = document.getElementById('user-id-display');
                toastContainer = document.getElementById('toast-container');

                // Mostrar spinner de conex√£o inicial
                showSpinner('Conectando...');

                // Iniciar autentica√ß√£o
                handleAuth(); // **NOVA L√ìGICA ROBUSTA**

                // Listeners de bot√µes
                createGameBtn.onclick = createGame;
                joinGameBtn.onclick = joinGame;
                boneyard.onclick = drawFromBoneyard;
                passTurnBtn.onclick = passTurn;

            } catch (e) {
                console.error("Erro ao inicializar:", e);
                showModal(`
                    <div class="m3-card text-center p-6">
                        <span class="material-icons text-5xl text-red-500 mb-4">error</span>
                        <h2 class="text-2xl font-bold mb-2">Erro na Inicializa√ß√£o</h2>
                        <p class="text-gray-700">N√£o foi poss√≠vel carregar o jogo. Verifique o console.</p>
                        <p class="text-xs text-gray-500">${e.message}</p>
                    </div>
                `);
            }
        };

        // *** MELHORIA CR√çTICA DE AUTENTICA√á√ÉO ***
        // Este √© o novo fluxo robusto. Ele usa onAuthStateChanged como a
        // √∫nica fonte da verdade e reage a mudan√ßas de estado.
        async function handleAuth() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // Caso 1: Usu√°rio est√° logado (ou acabou de logar)
                    currentUserId = user.uid;
                    console.log("Autenticado com UID:", currentUserId);
                    userIdDisplay.innerText = `Seu ID de Jogador: ${currentUserId.substring(0, 8)}`;
                    
                    hideModal(); // Esconde o spinner
                    authScreen.classList.remove('hidden');
                    gameScreen.classList.add('hidden');
                } else {
                    // Caso 2: Usu√°rio N√ÉO est√° logado (user === null)
                    console.log("Nenhum usu√°rio logado. Tentando login...");
                    // Mant√©m o spinner "Conectando..." vis√≠vel
                    try {
                        if (authToken) {
                            console.log("Tentando login com Custom Token...");
                            await signInWithCustomToken(auth, authToken);
                            // Se sucesso, onAuthStateChanged vai rodar de novo, caindo no "if (user)"
                        } else {
                            console.log("Tentando login an√¥nimo...");
                            await signInAnonymously(auth);
                            // Se sucesso, onAuthStateChanged vai rodar de novo, caindo no "if (user)"
                        }
                    } catch (e) {
                        // Caso 3: A tentativa de login FALHOU
                        console.error("Erro na autentica√ß√£o:", e);
                        showModal(`
                            <div class="m3-card text-center p-6">
                                <span class="material-icons text-5xl text-red-500 mb-4">error</span>
                                <h2 class="text-2xl font-bold mb-2">Erro de Autentica√ß√£o</h2>
                                <p class="text-gray-700 mb-4">N√£o foi poss√≠vel conectar. Verifique se o login an√¥nimo (ou o provedor de token) est√° ativado no seu projeto Firebase.</p>
                                <p class="text-xs text-gray-500">${e.message}</p>
                            </div>
                        `);
                    }
                }
            });
        }


        function getGameRef(gameId) {
            // Todos os jogos s√£o p√∫blicos para que outros possam encontr√°-los
            return doc(db, 'artifacts', appId, 'public', 'data', 'domino_games', gameId);
        }

        // --- L√≥gica de Lobby (Criar/Entrar) -------------------------------------

        async function createGame() {
            const gameId = gameIdInput.value.trim().toUpperCase();
            if (!gameId) {
                showToast("Digite um ID para o jogo", "warning");
                gameIdInput.focus();
                return;
            }

            if (gameId.length < 3) {
                showToast("ID deve ter pelo menos 3 caracteres", "warning");
                gameIdInput.focus();
                return;
            }

            showSpinner('Criando jogo...');
            const gameRef = getGameRef(gameId);

            try {
                const gameDoc = await getDoc(gameRef);
                if (gameDoc.exists()) {
                    showToast("Jogo j√° existe. Tente outro ID.", "error");
                    hideModal();
                    return;
                }

                const newGameState = {
                    gameId: gameId,
                    hostId: currentUserId,
                    playerIds: [currentUserId], // Come√ßa com o host
                    players: {}, // M√£os e scores
                    gameStatus: 'waiting', // waiting, playing, ended
                    board: [], // Pe√ßas no tabuleiro
                    boneyard: [], // Pe√ßas no monte
                    openEnds: [null, null], // [esquerda, direita]
                    currentPlayerId: null,
                    passCount: 0,
                    log: [`Jogo "${gameId}" criado por ${currentUserId.substring(0, 5)}...`],
                    winner: null,
                    createdAt: new Date().toISOString()
                };

                await setDoc(gameRef, newGameState);
                console.log("Jogo criado:", gameId);
                showToast(`Jogo "${gameId}" criado com sucesso!`, "success");
                listenToGame(gameId);

            } catch (e) {
                console.error("Erro ao criar jogo:", e);
                showToast("Erro ao criar jogo. Tente novamente.", "error");
                hideModal();
            }
        }

        async function joinGame() {
            const gameId = gameIdInput.value.trim().toUpperCase();
            if (!gameId) {
                showToast("Digite um ID de jogo", "warning");
                gameIdInput.focus();
                return;
            }

            showSpinner('Entrando no jogo...');
            const gameRef = getGameRef(gameId);

            try {
                const gameDoc = await getDoc(gameRef);
                if (!gameDoc.exists()) {
                    showToast("Jogo n√£o encontrado", "error");
                    hideModal();
                    return;
                }

                const gameState = gameDoc.data();

                if (gameState.gameStatus !== 'waiting' && gameState.gameStatus !== 'ended') {
                    // Permite re-entrar se o jogo acabou para ver o placar
                    if(gameState.gameStatus === 'playing') {
                        showToast("Jogo j√° come√ßou", "error");
                        hideModal();
                        return;
                    }
                }

                if (gameState.playerIds.includes(currentUserId)) {
                    // J√° est√° no jogo, apenas come√ßa a escutar
                    console.log("Reentrando no jogo...");
                    showToast("Reentrando no jogo...", "info");
                    listenToGame(gameId);
                    return;
                }

                if (gameState.playerIds.length >= 4 && gameState.gameStatus === 'waiting') {
                    showToast("Jogo cheio (m√°ximo 4 jogadores)", "error");
                    hideModal();
                    return;
                }

                // Adiciona novo jogador (apenas se 'waiting')
                if (gameState.gameStatus === 'waiting') {
                    const newPlayerIds = [...gameState.playerIds, currentUserId];
                    const newLog = [...gameState.log, `${currentUserId.substring(0, 5)}... entrou no jogo.`];
                    
                    await updateDoc(gameRef, {
                        playerIds: newPlayerIds,
                        log: newLog
                    });
                }

                console.log("Entrou no jogo:", gameId);
                showToast(`Entrou no jogo "${gameId}"!`, "success");
                listenToGame(gameId);

            } catch (e) {
                console.error("Erro ao entrar no jogo:", e);
                showToast("Erro ao entrar no jogo. Tente novamente.", "error");
                hideModal();
            }
        }

        function listenToGame(gameId) {
            currentGameId = gameId;
            hideModal(); // Esconde o spinner de "entrando..."
            authScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            const gameRef = getGameRef(gameId);

            if (gameUnsubscribe) {
                gameUnsubscribe(); // Para de escutar jogos antigos
            }

            gameUnsubscribe = onSnapshot(gameRef, (doc) => {
                if (doc.exists()) {
                    console.log("Dados do jogo recebidos:", doc.data());
                    localGameState = doc.data();
                    renderGame(localGameState);
                } else {
                    console.warn("O jogo foi deletado ou n√£o existe.");
                    showToast("O jogo foi encerrado", "error");
                    leaveGame();
                }
            }, (error) => {
                console.error("Erro no listener do jogo:", error);
                showToast("Erro de conex√£o com o jogo", "error");
                leaveGame();
            });
        }

        function leaveGame() {
            if (gameUnsubscribe) {
                gameUnsubscribe();
            }
            gameUnsubscribe = null;
            localGameState = null;
            currentGameId = null;

            gameScreen.classList.add('hidden');
            authScreen.classList.remove('hidden');
            hideModal(); // Garante que qualquer modal (ex: vit√≥ria) seja fechado
        }

        // --- Renderiza√ß√£o do Jogo -----------------------------------------------

        function renderGame(state) {
            if (!state) return;
            
            // N√£o renderiza se um modal estiver ativo (exceto tela de vit√≥ria)
            if (!modalOverlay.classList.contains('hidden') && state.gameStatus !== 'ended') {
                return;
            }

            // Limpa √°reas
            opponentHands.innerHTML = '';
            playerHand.innerHTML = '';
            boardArea.innerHTML = '';
            gameLog.innerHTML = '';

            // 1. Informa√ß√µes do Jogo
            let turnText = "Carregando...";
            let statusColor = "text-gray-600";
            
            if (state.gameStatus === 'waiting') {
                turnText = `Aguardando jogadores... (${state.playerIds.length}/4)`;
                statusColor = "text-blue-600";
            } else if (state.gameStatus === 'playing') {
                if (state.currentPlayerId === currentUserId) {
                    turnText = "√â a sua vez!";
                    statusColor = "text-green-600 font-semibold";
                } else {
                    turnText = `Vez de: ${state.currentPlayerId.substring(0, 5)}...`;
                    statusColor = "text-amber-600";
                }
            } else if (state.gameStatus === 'ended') {
                turnText = `Fim de Jogo! Vencedor: ${state.winner.substring(0, 5)}...`;
                statusColor = "text-purple-600 font-semibold";
            }
            
            gameInfo.innerHTML = `
                <div class="m3-card">
                    <h2 class="text-xl font-bold text-gray-800">Jogo: ${state.gameId}</h2>
                    <p class="text-lg ${statusColor} mt-2">${turnText}</p>
                    <div class="flex flex-wrap gap-2 mt-3">
                        <span class="m3-chip">Jogadores: ${state.playerIds.length}/4</span>
                        ${state.gameStatus === 'playing' ? `<span class="m3-chip">Pe√ßas no monte: ${state.boneyard.length}</span>` : ''}
                    </div>
                </div>
            `;

            // 2. Bot√£o de Iniciar (apenas para o Host)
            if (state.gameStatus === 'waiting' && state.hostId === currentUserId) {
                if (state.playerIds.length >= 2) {
                    const startGameBtn = document.createElement('button');
                    startGameBtn.innerHTML = `<span class="material-icons" style="font-size: 1.125rem;">play_arrow</span> Iniciar Jogo (${state.playerIds.length} jogadores)`;
                    startGameBtn.className = "m3-button m3-button-filled mt-4";
                    startGameBtn.onclick = () => startGame(state);
                    gameInfo.querySelector('.m3-card').appendChild(startGameBtn);
                } else {
                    const waitingText = document.createElement('p');
                    waitingText.className = "text-sm text-gray-500 mt-3";
                    waitingText.innerText = "Aguardando pelo menos 2 jogadores...";
                    gameInfo.querySelector('.m3-card').appendChild(waitingText);
                }
            }

            // Se o jogo n√£o come√ßou, n√£o renderiza o resto
            if (state.gameStatus !== 'playing' && state.gameStatus !== 'ended') {
                gameControls.classList.add('hidden');
                return;
            }
            
            gameControls.classList.remove('hidden');

            const isMyTurn = state.currentPlayerId === currentUserId && state.gameStatus === 'playing';

            // 3. M√£os dos Oponentes
            state.playerIds.forEach(pid => {
                if (pid === currentUserId) return; // Pula o pr√≥prio jogador
                const hand = state.players[pid] ? state.players[pid].hand : [];
                
                const opponentDiv = document.createElement('div');
                opponentDiv.className = 'flex flex-col items-center mx-4';
                opponentDiv.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="font-medium text-gray-700">${pid.substring(0, 5)}...</span>
                        <span class="m3-chip">${hand.length} pe√ßas</span>
                    </div>
                `;
                
                const cardsDiv = document.createElement('div');
                cardsDiv.className = 'flex flex-wrap justify-center';
                for (let i = 0; i < hand.length; i++) {
                    cardsDiv.innerHTML += `<div class="domino-back"></div>`;
                }
                opponentDiv.appendChild(cardsDiv);
                opponentHands.appendChild(opponentDiv);
            });

            // 4. Tabuleiro (Board)
            if (state.board.length === 0) {
                const emptyBoardMsg = document.createElement('div');
                emptyBoardMsg.className = 'flex flex-col items-center justify-center h-full text-gray-500';
                emptyBoardMsg.innerHTML = `
                    <span class="material-icons mb-2" style="font-size: 3rem;">dashboard_customize</span>
                    <p class="text-lg">O jogo come√ßar√° aqui</p>
                `;
                boardArea.appendChild(emptyBoardMsg);
            } else {
                state.board.forEach(piece => {
                    boardArea.appendChild(createDominoElement(piece, true));
                });
            }

            // 5. M√£o do Jogador
            const myHand = state.players[currentUserId] ? state.players[currentUserId].hand : [];
            
            if (myHand.length === 0) {
                const emptyHandMsg = document.createElement('div');
                emptyHandMsg.className = 'text-center text-gray-500 py-4';
                emptyHandMsg.innerHTML = `
                    <span class="material-icons mb-2" style="font-size: 2rem;">inventory_2</span>
                    <p>Voc√™ n√£o tem pe√ßas</p>
                `;
                playerHand.appendChild(emptyHandMsg);
            } else {
                myHand.forEach((piece, index) => {
                    const pieceEl = createDominoElement(piece, false);
                    if (isMyTurn) {
                        pieceEl.onclick = () => onPieceClick(piece, index);
                        pieceEl.classList.add('cursor-pointer');
                    } else {
                        pieceEl.classList.add('opacity-70', 'cursor-not-allowed');
                    }
                    playerHand.appendChild(pieceEl);
                });
            }

            // 6. Controles (Monte, Passar)
            boneyard.innerHTML = `<span class="material-icons" style="font-size: 1.25rem;">style</span> Monte (${state.boneyard.length})`;
            
            if (isMyTurn) {
                boneyard.classList.remove('opacity-50', 'cursor-not-allowed');
                passTurnBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                boneyard.disabled = state.boneyard.length === 0;
                passTurnBtn.disabled = false;
                
                // Adiciona efeito visual para indicar que √© a vez do jogador
                playerHand.classList.add('ring-2', 'ring-green-500', 'ring-opacity-50', 'rounded-lg');
            } else {
                boneyard.classList.add('opacity-50', 'cursor-not-allowed');
                passTurnBtn.classList.add('opacity-50', 'cursor-not-allowed');
                boneyard.disabled = true;
                passTurnBtn.disabled = true;
                playerHand.classList.remove('ring-2', 'ring-green-500', 'ring-opacity-50', 'rounded-lg');
            }

            // 7. Log
            if (state.log.length === 0) {
                const emptyLogMsg = document.createElement('p');
                emptyLogMsg.className = 'text-sm text-gray-500 italic';
                emptyLogMsg.innerText = "Nenhuma a√ß√£o registrada ainda...";
                gameLog.appendChild(emptyLogMsg);
            } else {
                state.log.slice(-8).reverse().forEach(msg => { // Mostra √∫ltimas 8 msgs
                    const logEntry = document.createElement('p');
                    logEntry.className = 'text-sm text-gray-700 py-1 border-b border-gray-100 last:border-b-0';
                    logEntry.innerText = msg;
                    gameLog.appendChild(logEntry);
                });
            }

            // 8. Tela de Vit√≥ria
            if (state.gameStatus === 'ended') {
                showWinScreen(state.winner, state.players);
            }
        }
        
        function createDominoElement(piece, isBoardPiece) {
            const el = document.createElement('div');
            el.className = isBoardPiece ? 'domino-board' : 'domino';
            
            // Adiciona classe 'double' se for bucha E estiver no tabuleiro
            if (isBoardPiece && piece.top === piece.bottom) {
                el.classList.add('double');
            }
            
            el.innerHTML = `
                <div class="domino-half">${piece.top}</div>
                <div class="domino-divider"></div>
                <div class="domino-half">${piece.bottom}</div>
            `;
            return el;
        }

        function showWinScreen(winnerId, players) {
            let scoreText = "Fim de Jogo!<br>";
            const isWinner = winnerId === currentUserId;
            
            if (isWinner) {
                scoreText += `<strong class="text-2xl text-green-600">üéâ Parab√©ns, voc√™ venceu! üéâ</strong><br><br>`;
            } else {
                scoreText += `Vencedor: <strong class="text-xl">${winnerId.substring(0, 8)}</strong><br><br>`;
            }
            
            scoreText += `Pontua√ß√£o final:`;
            
            let scores = [];
            for (const pid in players) {
                const hand = players[pid].hand;
                const score = hand.reduce((acc, p) => acc + p.top + p.bottom, 0);
                scores.push({ pid, score, isCurrentUser: pid === currentUserId });
            }
            
            scores.sort((a, b) => a.score - b.score);
            scores.forEach(s => {
                const userIndicator = s.isCurrentUser ? " (Voc√™)" : "";
                scoreText += `<br>${s.pid.substring(0, 8)}${userIndicator}: ${s.score} pontos`;
            });
            
            const modalHtml = `
                <div class="m3-card max-w-md w-full mx-4 text-center">
                    <div class="mb-4">
                        <span class="material-icons text-6xl ${isWinner ? 'text-green-500' : 'text-purple-500'}">emoji_events</span>
                    </div>
                    <h2 class="text-3xl font-bold mb-4 ${isWinner ? 'text-green-600' : 'text-purple-600'}">${isWinner ? 'Vit√≥ria!' : 'Fim de Jogo'}</h2>
                    <div class="text-lg mb-6">${scoreText}</div>
                    <div class="flex gap-3 justify-center">
                        <button id="new-game-btn" class="m3-button m3-button-filled">
                            <span class="material-icons" style="font-size: 1.125rem;">add</span>
                            Novo Jogo
                        </button>
                        <button id="leave-game-btn" class="m3-button m3-button-outlined">
                            <span class="material-icons" style="font-size: 1.125rem;">logout</span>
                            Voltar ao Lobby
                        </button>
                    </div>
                </div>
            `;
            
            showModal(modalHtml);
            
            document.getElementById('leave-game-btn').onclick = () => {
                showSpinner('Saindo...');
                leaveGame();
            };
            
            document.getElementById('new-game-btn').onclick = () => {
                showSpinner('Saindo...');
                leaveGame();
                setTimeout(() => {
                    gameIdInput.focus();
                }, 500);
            };
        }

        // --- L√≥gica de In√≠cio de Jogo ------------------------------------------

        async function startGame(currentState) {
            console.log("Iniciando o jogo...");
            showSpinner("Embaralhando e distribuindo...");
            try {
                const { playerIds } = currentState;
                
                const deck = createDeck();
                const shuffledDeck = shuffle(deck);
                
                // Distribuir pe√ßas
                const hands = {};
                playerIds.forEach(pid => { hands[pid] = { hand: [] }; });
                
                let piecesPerPlayer = 7;
                // Regra de domin√≥: 2-4 jogadores, 7 pe√ßas.
                
                for (let i = 0; i < piecesPerPlayer; i++) {
                    for (const pid of playerIds) {
                        hands[pid].hand.push(shuffledDeck.pop());
                    }
                }
                
                const boneyard = shuffledDeck; // O que sobrou
                
                // Encontrar jogador inicial (maior bucha)
                let startingPlayerId = null;
                let highestDouble = -1;
                
                playerIds.forEach(pid => {
                    hands[pid].hand.forEach(piece => {
                        if (piece.top === piece.bottom && piece.top > highestDouble) {
                            highestDouble = piece.top;
                            startingPlayerId = pid;
                        }
                    });
                });
                
                // Se ningu√©m tiver bucha (raro), o host come√ßa
                if (!startingPlayerId) {
                    startingPlayerId = currentState.hostId;
                }
                
                const newLog = [...currentState.log, `Jogo iniciado! ${startingPlayerId.substring(0, 5)}... come√ßa.`];
                
                // Atualiza o estado do jogo no Firebase
                await updateDoc(getGameRef(currentState.gameId), {
                    gameStatus: 'playing',
                    players: hands,
                    boneyard: boneyard,
                    board: [],
                    openEnds: [null, null],
                    currentPlayerId: startingPlayerId,
                    passCount: 0,
                    log: newLog
                });
                
                // hideModal() ser√° chamado pelo onSnapshot que recebe o novo estado

            } catch (e) {
                console.error("Erro ao iniciar jogo:", e);
                showToast("Erro ao iniciar jogo", "error");
                hideModal();
            }
        }

        function createDeck() {
            const deck = [];
            for (let i = 0; i <= 6; i++) {
                for (let j = i; j <= 6; j++) {
                    deck.push({ top: i, bottom: j });
                }
            }
            return deck; // 28 pe√ßas
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // --- L√≥gica de Turno ----------------------------------------------------

        // **NOVO** Modal para escolha de jogada
        function askMoveChoice(piece, validMoves) {
            return new Promise((resolve, reject) => {
                const modalHtml = `
                    <div class="m3-card max-w-md w-full mx-4 text-center">
                        <h2 class="text-2xl font-bold mb-4">Escolha sua Jogada</h2>
                        <p class="text-lg mb-6">Onde voc√™ quer jogar a pe√ßa [${piece.top}|${piece.bottom}]?</p>
                        
                        <!-- Pe√ßa de exemplo -->
                        <div class="flex justify-center mb-6">
                            ${createDominoElement(piece, false).outerHTML}
                        </div>
                        
                        <div class="flex flex-col gap-3">
                            ${validMoves.includes('left') ? `
                            <button id="modal-btn-left" class="m3-button m3-button-filled w-full">
                                <span class="material-icons" style="font-size: 1.125rem;">arrow_back</span>
                                Na Ponta Esquerda
                            </button>` : ''}
                            
                            ${validMoves.includes('right') ? `
                            <button id="modal-btn-right" class="m3-button m3-button-filled w-full">
                                <span class="material-icons" style="font-size: 1.125rem;">arrow_forward</span>
                                Na Ponta Direita
                            </button>` : ''}
                            
                            <button id="modal-btn-cancel" class="m3-button m3-button-text w-full">
                                Cancelar
                            </button>
                        </div>
                    </div>
                `;
                
                showModal(modalHtml);
                
                if (validMoves.includes('left')) {
                    document.getElementById('modal-btn-left').onclick = () => {
                        hideModal();
                        resolve('left');
                    };
                }
                if (validMoves.includes('right')) {
                    document.getElementById('modal-btn-right').onclick = () => {
                        hideModal();
                        resolve('right');
                    };
                }
                document.getElementById('modal-btn-cancel').onclick = () => {
                    hideModal();
                    reject(new Error("Jogada cancelada"));
                };
            });
        }

        async function onPieceClick(piece, pieceIndex) {
            console.log("Pe√ßa clicada:", piece);
            const state = localGameState;
            if (!state || state.currentPlayerId !== currentUserId || state.gameStatus !== 'playing') {
                return;
            }

            const { board, openEnds } = state;
            const [leftEnd, rightEnd] = openEnds;
            
            let playedPiece = { ...piece }; // Pe√ßa como ser√° jogada (pode ser invertida)

            // **L√ìGICA DE MOVIMENTO MELHORADA**
            const validMoves = [];
            if (board.length === 0) {
                validMoves.push('first');
            } else {
                if (piece.top === leftEnd || piece.bottom === leftEnd) {
                    validMoves.push('left');
                }
                if (piece.top === rightEnd || piece.bottom === rightEnd) {
                    validMoves.push('right');
                }
            }

            if (validMoves.length === 0) {
                showToast("Movimento inv√°lido. Esta pe√ßa n√£o encaixa.", "warning");
                return;
            }

            let move;
            try {
                // Se pode jogar em > 1 lugar (ex: 'left' e 'right'), pergunta ao usu√°rio
                if (validMoves.length > 1) {
                    move = await askMoveChoice(piece, validMoves);
                } else {
                    move = validMoves[0];
                }
            } catch (e) {
                console.log("Jogada cancelada pelo usu√°rio.");
                return; // Usu√°rio apertou 'cancelar'
            }

            // Se chegou aqui, o movimento √© v√°lido e foi escolhido.
            
            // 1. Atualiza o tabuleiro
            let newBoard = [...board];
            let newOpenEnds = [...openEnds];
            
            if (move === 'first') {
                newBoard.push(playedPiece);
                newOpenEnds = [playedPiece.top, playedPiece.bottom];
            } else if (move === 'left') {
                if (piece.top === leftEnd) {
                    playedPiece = { top: piece.bottom, bottom: piece.top }; // Inverte
                }
                newBoard.unshift(playedPiece); // Adiciona no in√≠cio
                newOpenEnds[0] = playedPiece.top; // Nova ponta esquerda
            } else if (move === 'right') {
                if (piece.bottom === rightEnd) {
                    playedPiece = { top: piece.bottom, bottom: piece.top }; // Inverte
                }
                newBoard.push(playedPiece); // Adiciona no fim
                newOpenEnds[1] = playedPiece.bottom; // Nova ponta direita
            }

            // 2. Atualiza a m√£o do jogador
            const myHand = state.players[currentUserId].hand;
            const newHand = myHand.filter((_, i) => i !== pieceIndex);
            
            // 3. Atualiza o objeto 'players'
            const newPlayers = {
                ...state.players,
                [currentUserId]: { hand: newHand }
            };

            // 4. Pr√≥ximo jogador
            const nextPlayerId = getNextPlayerId(state.playerIds, currentUserId);

            // 5. Log
            const newLog = [...state.log, `${currentUserId.substring(0, 5)}... jogou [${playedPiece.top}|${playedPiece.bottom}].`];

            // 6. Prepara o payload
            const updatePayload = {
                board: newBoard,
                openEnds: newOpenEnds,
                players: newPlayers,
                currentPlayerId: nextPlayerId,
                passCount: 0, // Reseta a contagem de passes
                log: newLog,
                gameStatus: state.gameStatus,
                winner: state.winner
            };

            // 7. Verifica condi√ß√£o de vit√≥ria
            if (newHand.length === 0) {
                console.log("JOGADOR VENCEU!");
                updatePayload.gameStatus = 'ended';
                updatePayload.winner = currentUserId;
                showToast("üéâ Parab√©ns! Voc√™ venceu o jogo! üéâ", "success", 5000);
            }
            
            // 8. Envia a atualiza√ß√£o
            try {
                await updateDoc(getGameRef(currentGameId), updatePayload);
            } catch (e) {
                console.error("Erro ao jogar pe√ßa:", e);
                showToast("Erro ao jogar pe√ßa. Tente novamente.", "error");
            }
        }

        async function drawFromBoneyard() {
            const state = localGameState;
            if (!state || state.currentPlayerId !== currentUserId || state.gameStatus !== 'playing') return;
            
            if (state.boneyard.length === 0) {
                showToast("Monte vazio. N√£o h√° pe√ßas para comprar.", "warning");
                return;
            }

            // Pega a pe√ßa
            const newBoneyard = [...state.boneyard];
            const drawnPiece = newBoneyard.pop(); // Pega a √∫ltima pe√ßa

            // Adiciona na m√£o
            const myHand = state.players[currentUserId].hand;
            const newHand = [...myHand, drawnPiece];
            
            // Atualiza players
            const newPlayers = {
                ...state.players,
                [currentUserId]: { hand: newHand }
            };

            const newLog = [...state.log, `${currentUserId.substring(0, 5)}... comprou do monte.`];

            // Atualiza Firebase. O turno N√ÉO PASSA. O jogador pode jogar ou passar.
            try {
                await updateDoc(getGameRef(currentGameId), {
                    boneyard: newBoneyard,
                    players: newPlayers,
                    log: newLog
                });
                showToast(`Voc√™ comprou a pe√ßa [${drawnPiece.top}|${drawnPiece.bottom}].`, "info");
            } catch (e) {
                console.error("Erro ao comprar do monte:", e);
                showToast("Erro ao comprar do monte. Tente novamente.", "error");
            }
        }

        async function passTurn() {
            const state = localGameState;
            if (!state || state.currentPlayerId !== currentUserId || state.gameStatus !== 'playing') return;
            
            // Verifica se o jogador pode mesmo passar
            const myHand = state.players[currentUserId].hand;
            const [leftEnd, rightEnd] = state.openEnds;

            let canPlay = false;
            if (state.board.length === 0) {
                canPlay = myHand.length > 0; // Se for o primeiro, pode jogar qualquer coisa
            } else {
                for (const piece of myHand) {
                    if (piece.top === leftEnd || piece.bottom === leftEnd || piece.top === rightEnd || piece.bottom === rightEnd) {
                        canPlay = true;
                        break;
                    }
                }
            }

            if (canPlay) {
                showToast("Voc√™ tem uma pe√ßa que pode ser jogada!", "warning");
                return;
            }
            
            if (state.boneyard.length > 0) {
                showToast("Voc√™ deve comprar do monte antes de passar!", "warning");
                return;
            }

            // Se chegou aqui, o jogador n√£o pode jogar E o monte est√° vazio.
            // O passe √© v√°lido.

            const nextPlayerId = getNextPlayerId(state.playerIds, currentUserId);
            const newPassCount = (state.passCount || 0) + 1;
            const newLog = [...state.log, `${currentUserId.substring(0, 5)}... passou o turno.`];
            
            const updatePayload = {
                currentPlayerId: nextPlayerId,
                passCount: newPassCount,
                log: newLog,
                gameStatus: state.gameStatus,
                winner: state.winner
            };

            // Verifica se o jogo est√° bloqueado
            if (newPassCount >= state.playerIds.length) {
                console.log("JOGO BLOQUEADO!");
                updatePayload.gameStatus = 'ended';
                // Encontra o vencedor pela menor soma de pontos
                let minScore = Infinity;
                let winnerId = null;
                
                state.playerIds.forEach(pid => {
                    const hand = state.players[pid].hand;
                    const score = hand.reduce((acc, p) => acc + p.top + p.bottom, 0);
                    if (score < minScore) {
                        minScore = score;
                        winnerId = pid;
                    } else if (score === minScore) {
                        // L√≥gica de desempate (ex: quem jogou por √∫ltimo, ou o abridor)
                        // Por simplicidade, o primeiro a atingir o minScore vence
                        if (winnerId === null) {
                            winnerId = pid;
                        }
                    }
                });
                
                // Se ningu√©m tiver pe√ßas (empate 0-0, raro), o 'winnerId' pode ser o primeiro jogador
                if (winnerId === null) winnerId = state.hostId; 
                
                updatePayload.winner = winnerId;
                updatePayload.log.push(`Jogo bloqueado! Vencedor: ${winnerId.substring(0, 5)}... com ${minScore} pontos.`);
            }

            try {
                await updateDoc(getGameRef(currentGameId), updatePayload);
                showToast("Voc√™ passou a vez.", "info");
            } catch (e) {
                console.error("Erro ao passar turno:", e);
                showToast("Erro ao passar turno. Tente novamente.", "error");
            }
        }

        function getNextPlayerId(playerIds, currentPlayerId) {
            const currentIndex = playerIds.indexOf(currentPlayerId);
            const nextIndex = (currentIndex + 1) % playerIds.length;
            return playerIds[nextIndex];
        }

    </script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-100 font-sans flex items-center justify-center min-h-screen p-4">

    <!-- Tela de Modal (Loading, Vit√≥ria, Escolha) -->
    <div id="modal-overlay" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div id="modal-content">
            <!-- Conte√∫do do modal ser√° injetado aqui -->
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-white text-lg">Carregando...</p>
            </div>
        </div>
    </div>

    <!-- Container de Toasts -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-[100] flex flex-col gap-2">
        <!-- Notifica√ß√µes Toast ser√£o injetadas aqui -->
    </div>

    <!-- Tela de Autentica√ß√£o / Lobby -->
    <div id="auth-screen" class="hidden max-w-md w-full">
        <div class="m3-card text-center">
            <div class="mb-6">
                <span class="material-icons text-5xl text-purple-500 mb-4">dashboard_customize</span>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Domin√≥ Multiplayer</h1>
                <p class="text-gray-600">Jogue domin√≥ online com amigos em tempo real</p>
            </div>
            
            <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                <p id="user-id-display" class="text-sm text-gray-700 font-medium">Carregando ID...</p>
            </div>
            
            <div class="mb-6">
                <label for="game-id-input" class="block text-sm font-medium text-gray-700 mb-2 text-left">ID do Jogo</label>
                <input type="text" id="game-id-input" placeholder="Ex: SALA123" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent uppercase font-medium"
                       oninput="this.value = this.value.toUpperCase()" autocomplete="off">
                <p class="text-xs text-gray-500 mt-2 text-left">Use um ID √∫nico para criar ou entrar em um jogo</p>
            </div>
            
            <div class="flex flex-col gap-3">
                <button id="create-game-btn" class="m3-button m3-button-filled w-full">
                    <span class="material-icons" style="font-size: 1.125rem;">add</span>
                    Criar Novo Jogo
                </button>
                <button id="join-game-btn" class="m3-button m3-button-outlined w-full">
                    <span class="material-icons" style="font-size: 1.125rem;">login</span>
                    Entrar em Jogo Existente
                </button>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-200">
                <p class="text-xs text-gray-500">Jogue com 2 a 4 jogadores. Cada jogador recebe 7 pe√ßas.</p>
            </div>
        </div>
    </div>

    <!-- Tela Principal do Jogo -->
    <div id="game-screen" class="hidden w-full max-w-7xl h-screen flex flex-col p-4">
        
        <!-- Header com Info e M√£os dos Oponentes -->
        <div class="flex flex-col md:flex-row justify-between items-start mb-4 gap-4">
            <div id="game-info" class="flex-1 max-w-md">
                <!-- Info do jogo ser√° injetada aqui -->
            </div>
            
            <div id="opponent-hands" class="flex flex-wrap justify-center gap-4 flex-1">
                <!-- M√£os dos oponentes aqui -->
            </div>
        </div>

        <!-- Tabuleiro (Centro) -->
        <div id="board-area" class="flex-grow bg-gradient-to-br from-green-600 to-green-800 border-4 border-green-900 rounded-2xl p-6 flex flex-nowrap justify-start items-center overflow-x-auto shadow-inner min-h-[200px]">
            <!-- Pe√ßas do tabuleiro aqui -->
        </div>

        <!-- Controles e Log (Meio/Baixo) -->
        <div class="flex flex-col md:flex-row justify-between items-stretch my-4 gap-4">
            <div id="game-controls" class="hidden flex flex-col md:flex-row gap-3">
                <button id="boneyard" class="m3-button m3-button-filled">
                    <!-- √çcone e texto ser√£o injetados -->
                </button>
                <button id="pass-turn-btn" class="m3-button m3-button-outlined">
                    <span class="material-icons" style="font-size: 1.125rem;">skip_next</span>
                    Passar Vez
                </button>
            </div>
            <div class="m3-card flex-1 max-w-md ml-auto">
                <h3 class="font-bold text-gray-800 mb-2">Hist√≥rico do Jogo</h3>
                <div id="game-log" class="h-32 overflow-y-auto">
                    <!-- Log do Jogo -->
                </div>
            </div>
        </div>

        <!-- M√£o do Jogador (Baixo) -->
        <div class="m3-card rounded-t-2xl rounded-b-none shadow-lg mt-auto">
            <h3 class="font-bold text-gray-800 mb-3 text-center">Sua M√£o</h3>
            <div id="player-hand" class="min-h-[140px] flex justify-center items-center flex-wrap gap-3 p-4 bg-gray-50 rounded-lg overflow-x-auto">
                <!-- Pe√ßas do jogador aqui -->
            </div>
        </div>
    </div>

</body>
</html>

