<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAyfJtCTZdIt5IUG5BZNmDd9UiaKBIyKZY",
  authDomain: "arenadeconhecimento.firebaseapp.com",
  databaseURL: "https://arenadeconhecimento-default-rtdb.firebaseio.com",
  projectId: "arenadeconhecimento",
  storageBucket: "arenadeconhecimento.firebasestorage.app",
  messagingSenderId: "889132093510",
  appId: "1:889132093510:web:d9d7ddd92fec82d247ba47"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= PRODUTOS COMPLETOS ================= */

const categorias = {

"REFRIGERADOR":[
"NR-BB71GVFB","NR-BB71GV7B","NR-BB71PVFX","NR-BB71PV7X","NR-BB71PV4B",
"NR-BB64PV1X","NR-BB64PV1B","NR-BB64PV2B","NR-BB65GVFB","NR-BB65GV7B",
"NR-BB41GV1B","NR-BB41GV2B","NR-BB41PV1T","NR-BB41PV2T","NR-BT56PD4W",
"NR-BT56PD4X","NR-BT41PD1X","NR-BT41PD1W","NR-BT41PD2W","NR-BT44PV3X",
"NR-BT44PV3B","NR-DB69","NR-DB99"
],

"LAVADORA":[
"NA-F120B1W","NA-F120B1TA","NA-F120B5G","NA-F130B1W","NA-F130B1T",
"NA-F140B1W","NA-F150B1T","NA-F150B1W","NA-F160B6W","NA-F170B7W",
"NA-F180D1WA","NA-F180P7T","NA-F190G1BW","NA-F190G1B","NA-S26MK1LB"
],

"MICROONDAS":[
"NN-ST25L","NN-ST27L","NN-ST55L","NN-ST65L","NN-GT68L","NN-CD89",
"NN-ST67L","NN-ST61N","NN-ST66N"
],

"FORNO / COOKTOP / COZINHA":[
"NN-GB68QBRUK","NN-GB68QSRUK","HL-CX668SRPK","HL-CX672BRPK",
"NP-6M2FTKBRP","NP-6M1MBKBRP","KY-W648CLRPK","KY-T937XLRPK",
"FV-6HSUB2","FV-9HSDB2"
],

"CUIDADOS PESSOAIS":[
"ER-GK20","ER-GN30","ER-GN25","ER-GK80","ER-GB80",
"ER-389X","EW-DJ10","ER389X"
]

};

/* ================= RENDER TABELAS ================= */

const container = document.getElementById("produtosContainer");

Object.keys(categorias).forEach(cat=>{

let bloco = document.createElement("div");
bloco.className="mb-8";

bloco.innerHTML = `
<h2 class="text-xl font-bold text-blue-900 mb-3">${cat}</h2>
<div class="overflow-auto">
<table class="min-w-full text-sm border">
<thead class="bg-blue-900 text-white">
<tr>
<th class="p-2 text-left">Produto</th>
<th class="p-2">Preço</th>
<th class="p-2">CD</th>
<th class="p-2">Concorrente</th>
<th class="p-2">Preço Conc.</th>
</tr>
</thead>
<tbody id="tbody_${cat.replace(/\s/g,'')}"></tbody>
</table>
</div>
`;

container.appendChild(bloco);

let tbody = bloco.querySelector("tbody");

categorias[cat].forEach(prod=>{
let tr=document.createElement("tr");
tr.innerHTML=`
<td class="border p-2 font-semibold">${prod}</td>
<td class="border p-1"><input class="input preco w-full"></td>
<td class="border p-1"><input class="input cd w-full"></td>
<td class="border p-1">
<input list="listaConc" class="input concorrente w-full">
</td>
<td class="border p-1"><input class="input precoConc w-full"></td>
`;
tbody.appendChild(tr);
});

});

/* ================= AUTOCOMPLETE GLOBAL ================= */

const dataList=document.createElement("datalist");
dataList.id="listaConc";
document.body.appendChild(dataList);

onValue(ref(db,"concorrentes"),snapshot=>{
dataList.innerHTML="";
snapshot.forEach(child=>{
let opt=document.createElement("option");
opt.value=child.key;
dataList.appendChild(opt);
});
});

document.addEventListener("change",e=>{
if(e.target.classList.contains("concorrente")){
let nome=e.target.value.trim();
if(nome!==""){
set(ref(db,"concorrentes/"+nome),true);
}
}
});

/* ================= GERAR WHATSAPP ================= */

window.gerarWhatsApp=()=>{

let texto=`*ESTOQUE DA REVENDA*\n\n`;
texto+=`Revenda: ${revenda.value}\n`;
texto+=`Data: ${data.value}\n`;
texto+=`Consultor: ${consultor.value}\n`;
texto+=`Coordenador: ${coordenador.value}\n\n`;

Object.keys(categorias).forEach(cat=>{
texto+=`*${cat}*\n`;
categorias[cat].forEach(prod=>{
document.querySelectorAll("tr").forEach(tr=>{
if(tr.children[0] && tr.children[0].innerText===prod){
let inputs=tr.querySelectorAll("input");
if(inputs[0].value){
texto+=`${prod} - R$${inputs[0].value} | CD:${inputs[1].value} | ${inputs[2].value} R$${inputs[3].value}\n`;
}
}
});
});
texto+="\n";
});

saida.value=texto;
window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`);

};

/* ================= GERAR PDF ================= */

window.gerarPDF=()=>{

import("https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js").then(jsPDF=>{
const { jsPDF:PDF }=jsPDF;
let doc=new PDF();

doc.setFillColor(0,51,153);
doc.rect(0,0,210,20,"F");
doc.setTextColor(255,255,255);
doc.text("ESTOQUE PANASONIC",10,12);

doc.setTextColor(0,0,0);
let y=30;

Object.keys(categorias).forEach(cat=>{
doc.setFontSize(12);
doc.text(cat,10,y);
y+=8;

categorias[cat].forEach(prod=>{
document.querySelectorAll("tr").forEach(tr=>{
if(tr.children[0] && tr.children[0].innerText===prod){
let inputs=tr.querySelectorAll("input");
if(inputs[0].value){
doc.setFontSize(9);
doc.text(`${prod} - ${inputs[0].value} - CD ${inputs[1].value} - ${inputs[2].value}`,10,y);
y+=6;
}
}
});
});
y+=5;
});

doc.save("Estoque_Panasonic.pdf");

};

</script>

</head>

<body class="bg-blue-50 p-6">

<div class="max-w-7xl mx-auto bg-white p-6 rounded-xl shadow-xl">

<h1 class="text-3xl font-bold text-blue-900 mb-6">
Estoque Panasonic
</h1>

<div class="grid md:grid-cols-4 gap-4 mb-6">
<input id="revenda" placeholder="Revenda" class="border p-2 rounded">
<input id="data" type="date" class="border p-2 rounded">
<input id="consultor" placeholder="Consultor" class="border p-2 rounded">
<input id="coordenador" placeholder="Coordenador" class="border p-2 rounded">
</div>

<div id="produtosContainer"></div>

<div class="flex gap-4 mt-6">
<button onclick="gerarWhatsApp()" class="bg-green-600 text-white px-4 py-2 rounded">
Gerar WhatsApp
</button>
<button onclick="gerarPDF()" class="bg-blue-900 text-white px-4 py-2 rounded">
Gerar PDF Azul Panasonic
</button>
</div>

<textarea id="saida" class="w-full mt-4 h-40 border rounded p-2"></textarea>

</div>

</body>
</html>
