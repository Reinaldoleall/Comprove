<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>Panasonic ¬∑ Estoque & Concorr√™ncia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --pana-blue: #004c97; }
        .bg-panasonic { background-color: var(--pana-blue); }
        .text-panasonic { color: var(--pana-blue); }
        .border-panasonic { border-color: var(--pana-blue); }
        
        /* Oculta scrollbar para abas mas permite scroll */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .table-scroll { overflow-x: auto; display: block; white-space: nowrap; }
        input { transition: all 0.2s; }
        input:focus { outline: none; border-color: var(--pana-blue); box-shadow: 0 0 0 3px rgba(0, 76, 151, 0.15); }
        textarea:focus { outline: none; border-color: var(--pana-blue); box-shadow: 0 0 0 3px rgba(0, 76, 151, 0.15); }
    </style>
</head>
<body class="bg-slate-100 font-sans antialiased p-4 md:p-6 text-gray-800">

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAyfJtCTZdIt5IUG5BZNmDd9UiaKBIyKZY",
            authDomain: "arenadeconhecimento.firebaseapp.com",
            databaseURL: "https://arenadeconhecimento-default-rtdb.firebaseio.com",
            projectId: "arenadeconhecimento",
            storageBucket: "arenadeconhecimento.firebasestorage.app",
            messagingSenderId: "889132093510",
            appId: "1:889132093510:web:d9d7ddd92fec82d247ba47"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const concorrentesRef = db.ref('concorrentes');
    </script>

    <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden border-t-8 border-panasonic">
        
        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200 flex items-center justify-between">
            <h1 class="text-2xl font-black text-panasonic tracking-tight">ESTOQUE & CONCORR√äNCIA</h1>
            <span class="text-sm text-gray-400 font-medium bg-gray-200 px-3 py-1 rounded-full">Gerador Inteligente</span>
        </div>

        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">üì¶ Revenda</label>
                    <input type="text" id="revenda" placeholder="Nome da loja" class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 text-sm">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">üìÖ Data</label>
                    <input type="date" id="data" class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 text-sm text-gray-700">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">üë§ Consultor</label>
                    <input type="text" id="consultor" placeholder="Seu nome" class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 text-sm">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">üë• Coordenador</label>
                    <input type="text" id="coordenador" placeholder="Seu coordenador" class="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 text-sm">
                </div>
            </div>

            <datalist id="listaConcorrentes"></datalist>

            <div class="mb-6 flex overflow-x-auto hide-scrollbar gap-2 border-b-2 border-gray-100 pb-2">
                <a href="#refrigerador" class="tab-link whitespace-nowrap text-sm font-bold px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-panasonic transition">Refrigerador</a>
                <a href="#lavadora" class="tab-link whitespace-nowrap text-sm font-bold px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-panasonic transition">Lavadora</a>
                <a href="#microondas" class="tab-link whitespace-nowrap text-sm font-bold px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-panasonic transition">Microondas</a>
                <a href="#forno" class="tab-link whitespace-nowrap text-sm font-bold px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-panasonic transition">Forno/Cooktop</a>
                <a href="#pessoais" class="tab-link whitespace-nowrap text-sm font-bold px-4 py-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-blue-50 hover:text-panasonic transition">Cuidados Pessoais</a>
            </div>

            <div id="produtos-container" class="space-y-8"></div>

            <div class="mt-8 bg-gray-50 p-4 rounded-xl border border-gray-200">
                <label class="block text-sm font-bold text-gray-700 mb-2">üìù OBSERVA√á√ïES GERAIS</label>
                <textarea id="obs" rows="3" placeholder="Insira aqui destaques de vendas, promo√ß√µes agressivas da concorr√™ncia, etc..." class="w-full border border-gray-300 rounded-lg px-4 py-3 text-sm resize-none"></textarea>
            </div>

            <div class="mt-8 flex flex-wrap gap-3 justify-center lg:justify-end border-t border-gray-200 pt-6">
                <button id="salvarRascunho" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold text-sm px-6 py-2.5 rounded-lg shadow-sm flex items-center gap-2 transition">
                    üíæ Salvar Rascunho
                </button>
                <button id="carregarRascunho" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold text-sm px-6 py-2.5 rounded-lg shadow-sm flex items-center gap-2 transition">
                    üìÇ Carregar Rascunho
                </button>
                <div class="w-full lg:w-px lg:bg-gray-300 lg:mx-2 hidden lg:block"></div>
                <button id="copiarTexto" class="bg-slate-800 hover:bg-slate-900 text-white font-bold text-sm px-6 py-2.5 rounded-lg shadow-sm flex items-center gap-2 transition">
                    üìã Copiar Relat√≥rio
                </button>
                <button id="gerarWhatsApp" class="bg-green-600 hover:bg-green-700 text-white font-bold text-sm px-6 py-2.5 rounded-lg shadow-sm flex items-center gap-2 transition">
                    üì≤ Enviar WhatsApp
                </button>
                <button id="gerarPDF" class="bg-panasonic hover:bg-blue-900 text-white font-bold text-sm px-6 py-2.5 rounded-lg shadow-lg shadow-blue-900/20 flex items-center gap-2 transition transform hover:-translate-y-0.5">
                    üìÑ Gerar PDF Profissional
                </button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const categorias = [
                { id: 'refrigerador', nome: 'REFRIGERADOR', modelos: [
                    "NR-BB71GVFB", "NR-BB71GV7B", "NR-BB71PVFX", "NR-BB71PV7X", "NR-BB71PV4B",
                    "NR-BB64PV1X", "NR-BB64PV1B", "NR-BB64PV2B", "NR-BB65GVFB", "NR-BB65GV7B",
                    "NR-BB41GV1B", "NR-BB41GV2B", "NR-BB41PV1T", "NR-BB41PV2T", "NR-BT56PD4W",
                    "NR-BT56PD4X", "NR-BT41PD1X", "NR-BT41PD1W", "NR-BT41PD2W", "NR-BT44PV3X",
                    "NR-BT44PV3B", "NR-BB71PV7X", "NR-DB69", "NR-DB99"
                ] },
                { id: 'lavadora', nome: 'LAVADORA', modelos: [
                    "NA-F120B1W", "NA-F120B1TA", "NA-F120B5G", "NA-F130B1W", "NA-F130B1T",
                    "NA-F140B1W", "NA-F150B1T", "NA-F150B1W", "NA-F160B6W", "NA-F170B7W",
                    "NA-F180D1WA", "NA-F180P7T", "NA-F190G1BW", "NA-F190G1B", "NA-S26MK1LB"
                ] },
                { id: 'microondas', nome: 'MICROONDAS', modelos: [
                    "NN-ST25L", "NN-ST27L", "NN-ST55L", "NN-ST65L", "NN-GT68L",
                    "NN-CD89", "NN-ST67L", "NN-ST61N", "NN-ST66N", "NN-ST67L"
                ] },
                { id: 'forno', nome: 'FORNO / COOKTOP', modelos: [
                    "NN-GB68QBRUK", "NN-GB68QSRUK", "HL-CX668SRPK", "HL-CX672BRPK", "NP-6M2FTKBRP",
                    "NP-6M1MBKBRP", "KY-W648CLRPK", "KY-T937XLRPK", "FV-6HSUB2", "FV-9HSDB2"
                ] },
                { id: 'pessoais', nome: 'CUIDADOS PESSOAIS', modelos: [
                    "ER-GK20", "ER-GN30", "ER-GN25", "ER-GK80", "ER-GB80",
                    "ER-389X", "EW-DJ10", "ER389X"
                ] }
            ];

            let concorrentesSet = new Set();
            const datalist = document.getElementById('listaConcorrentes');

            function carregarConcorrentes() {
                concorrentesRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    concorrentesSet.clear();
                    if (data) {
                        Object.keys(data).forEach(key => concorrentesSet.add(key));
                    }
                    atualizarDatalist();
                });
            }

            function atualizarDatalist() {
                datalist.innerHTML = '';
                concorrentesSet.forEach(conc => {
                    const opt = document.createElement('option');
                    opt.value = conc;
                    datalist.appendChild(opt);
                });
            }

            function adicionarConcorrente(valor) {
                if (!valor || typeof valor !== 'string') return;
                valor = valor.trim();
                if (valor === '' || concorrentesSet.has(valor)) return;
                const safeKey = valor.replace(/[.#$\[\]]/g, '_');
                concorrentesRef.child(safeKey).set(true);
            }

            // Gera√ß√£o da Tabela no HTML
            const container = document.getElementById('produtos-container');
            function renderizarTabelas() {
                let html = '';
                categorias.forEach(cat => {
                    html += `<div id="${cat.id}" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6 scroll-mt-6">`;
                    html += `<div class="bg-panasonic px-5 py-3 text-white font-bold tracking-wide">${cat.nome}</div>`;
                    html += `<div class="table-scroll"><table class="min-w-full divide-y divide-gray-200">`;
                    
                    html += `<thead class="bg-gray-50"><tr>`;
                    html += `<th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">MODELO PANASONIC</th>`;
                    html += `<th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">PRE√áO (R$)</th>`;
                    html += `<th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">ESTOQUE CD</th>`;
                    html += `<th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">CONCORRENTE DIRETO</th>`;
                    html += `<th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">PRE√áO CONC. (R$)</th>`;
                    html += `</tr></thead><tbody class="bg-white divide-y divide-gray-100">`;
                    
                    cat.modelos.forEach((modelo, index) => {
                        const bgClass = index % 2 === 0 ? 'bg-white' : 'bg-slate-50';
                        html += `<tr class="${bgClass} hover:bg-blue-50 transition-colors">`;
                        html += `<td class="px-4 py-2 whitespace-nowrap font-mono font-medium text-sm text-gray-800">${modelo}</td>`;
                        html += `<td class="px-4 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="preco" placeholder="Ex: 3499,00" class="w-28 border border-gray-300 rounded-md px-3 py-1.5 text-sm bg-white"></td>`;
                        html += `<td class="px-4 py-2"><input type="number" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="cd" placeholder="Qtd" class="w-20 border border-gray-300 rounded-md px-3 py-1.5 text-sm bg-white"></td>`;
                        html += `<td class="px-4 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="concorrente" list="listaConcorrentes" placeholder="Marca / Modelo" class="w-48 border border-gray-300 rounded-md px-3 py-1.5 text-sm bg-white concorrente-input"></td>`;
                        html += `<td class="px-4 py-2"><input type="text" data-categoria="${cat.id}" data-modelo="${modelo}" data-campo="precoConcorrente" placeholder="Ex: 3300,00" class="w-28 border border-gray-300 rounded-md px-3 py-1.5 text-sm bg-white"></td>`;
                        html += `</tr>`;
                    });
                    html += `</tbody></table></div></div>`;
                });
                container.innerHTML = html;

                document.querySelectorAll('.concorrente-input').forEach(inp => {
                    inp.addEventListener('blur', (e) => {
                        const valor = e.target.value;
                        if (valor) adicionarConcorrente(valor);
                    });
                });
            }

            function preencherDataHoje() {
                const hoje = new Date();
                document.getElementById('data').value = hoje.toISOString().split('T')[0];
            }

            function salvarRascunho() {
                const rascunho = {
                    revenda: document.getElementById('revenda').value,
                    data: document.getElementById('data').value,
                    consultor: document.getElementById('consultor').value,
                    coordenador: document.getElementById('coordenador').value,
                    obs: document.getElementById('obs').value,
                    produtos: []
                };
                document.querySelectorAll('#produtos-container input[data-modelo]').forEach(inp => {
                    const categoria = inp.dataset.categoria;
                    const modelo = inp.dataset.modelo;
                    const campo = inp.dataset.campo;
                    const valor = inp.value;
                    let entry = rascunho.produtos.find(p => p.categoria === categoria && p.modelo === modelo);
                    if (!entry) {
                        entry = { categoria, modelo, preco: '', cd: '', concorrente: '', precoConcorrente: '' };
                        rascunho.produtos.push(entry);
                    }
                    entry[campo] = valor;
                });
                localStorage.setItem('rascunhoEstoque', JSON.stringify(rascunho));
                alert('‚úÖ Rascunho salvo com sucesso!');
            }

            function carregarRascunho() {
                const saved = localStorage.getItem('rascunhoEstoque');
                if (!saved) { alert('Nenhum rascunho salvo encontrado.'); return; }
                try {
                    const rascunho = JSON.parse(saved);
                    document.getElementById('revenda').value = rascunho.revenda || '';
                    document.getElementById('data').value = rascunho.data || '';
                    document.getElementById('consultor').value = rascunho.consultor || '';
                    document.getElementById('coordenador').value = rascunho.coordenador || '';
                    document.getElementById('obs').value = rascunho.obs || '';
                    
                    rascunho.produtos.forEach(p => {
                        const precoInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="preco"]`);
                        if (precoInp) precoInp.value = p.preco || '';
                        const cdInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="cd"]`);
                        if (cdInp) cdInp.value = p.cd || '';
                        const concInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="concorrente"]`);
                        if (concInp) concInp.value = p.concorrente || '';
                        const precoConcInp = document.querySelector(`input[data-categoria="${p.categoria}"][data-modelo="${p.modelo}"][data-campo="precoConcorrente"]`);
                        if (precoConcInp) precoConcInp.value = p.precoConcorrente || '';
                    });
                    alert('‚úÖ Dados carregados com sucesso!');
                } catch (e) {
                    alert('Erro ao carregar o rascunho.');
                }
            }

            // Gera√ß√£o de Texto Inteligente (Apenas Preenchidos)
            function gerarTextoCompleto() {
                let texto = '*üìä RELAT√ìRIO DE ESTOQUE E CONCORR√äNCIA*\n\n';
                
                texto += `*üè¢ Revenda:* ${document.getElementById('revenda').value || 'N√£o informada'}\n`;
                const d = document.getElementById('data').value;
                texto += `*üìÖ Data:* ${d ? d.split('-').reverse().join('/') : 'N√£o informada'}\n`;
                texto += `*üë§ Consultor:* ${document.getElementById('consultor').value || 'N√£o informado'}\n`;
                texto += `*üë• Coordenador:* ${document.getElementById('coordenador').value || 'N√£o informado'}\n\n`;

                let itensEncontrados = false;

                categorias.forEach(cat => {
                    let catTexto = `üîπ *${cat.nome}*\n`;
                    let temProdutoPreenchido = false;

                    cat.modelos.forEach(modelo => {
                        const preco = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="preco"]`)?.value.trim();
                        const cd = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="cd"]`)?.value.trim();
                        const conc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="concorrente"]`)?.value.trim();
                        const precoConc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="precoConcorrente"]`)?.value.trim();
                        
                        // Verifica se algo foi digitado nesta linha
                        if (preco || cd || conc || precoConc) {
                            temProdutoPreenchido = true;
                            itensEncontrados = true;
                            
                            catTexto += `‚ñ™Ô∏è *${modelo}*\n`;
                            if(preco || cd) {
                                catTexto += `  Pan: ${preco ? 'R$ '+preco : '-'} | CD: ${cd || '0'}\n`;
                            }
                            if(conc || precoConc) {
                                catTexto += `  Conc: ${conc || '-'} | ${precoConc ? 'R$ '+precoConc : '-'}\n`;
                            }
                            catTexto += `\n`;
                        }
                    });

                    if (temProdutoPreenchido) {
                        texto += catTexto + `\n`;
                    }
                });

                if(!itensEncontrados) {
                    texto += "Nenhum produto foi preenchido neste relat√≥rio.\n\n";
                }

                const obs = document.getElementById('obs').value.trim();
                if (obs) {
                    texto += `*üìù OBSERVA√á√ïES:*\n${obs}\n`;
                }

                return texto;
            }

            // Gerar PDF Profissional e Otimizado
            function gerarPDF() {
                const { jsPDF } = window.jspdf;
                // A4 formato Retrato fica mais profissional para relat√≥rios
                const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                
                // Cabe√ßalho Corporativo
                doc.setFillColor(0, 76, 151); // Azul Panasonic
                doc.rect(0, 0, doc.internal.pageSize.width, 25, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('ESTOQUE E CONCORR√äNCIA - PANASONIC', 14, 16);
                
                // √Årea de Dados do Cabe√ßalho
                doc.setTextColor(60, 60, 60);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                
                const revenda = document.getElementById('revenda').value || 'N√£o informada';
                const dataRaw = document.getElementById('data').value;
                const dataFormatada = dataRaw ? dataRaw.split('-').reverse().join('/') : 'N√£o informada';
                const consultor = document.getElementById('consultor').value || 'N√£o informado';
                const coordenador = document.getElementById('coordenador').value || 'N√£o informado';

                doc.text(`Revenda:`, 14, 34); doc.setFont('helvetica', 'normal'); doc.text(revenda, 32, 34);
                doc.setFont('helvetica', 'bold'); doc.text(`Data:`, 14, 40); doc.setFont('helvetica', 'normal'); doc.text(dataFormatada, 24, 40);
                
                doc.setFont('helvetica', 'bold'); doc.text(`Consultor:`, 110, 34); doc.setFont('helvetica', 'normal'); doc.text(consultor, 128, 34);
                doc.setFont('helvetica', 'bold'); doc.text(`Coord.:`, 110, 40); doc.setFont('helvetica', 'normal'); doc.text(coordenador, 123, 40);

                let finalY = 48;
                let teveProduto = false;

                categorias.forEach(cat => {
                    const linhasTabela = [];
                    
                    // Filtra apenas produtos preenchidos
                    cat.modelos.forEach(modelo => {
                        const preco = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="preco"]`)?.value.trim();
                        const cd = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="cd"]`)?.value.trim();
                        const conc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="concorrente"]`)?.value.trim();
                        const precoConc = document.querySelector(`input[data-categoria="${cat.id}"][data-modelo="${modelo}"][data-campo="precoConcorrente"]`)?.value.trim();
                        
                        if (preco || cd || conc || precoConc) {
                            linhasTabela.push([modelo, preco, cd, conc, precoConc]);
                        }
                    });

                    // S√≥ desenha a tabela se houver pelo menos 1 produto preenchido na categoria
                    if (linhasTabela.length > 0) {
                        teveProduto = true;
                        
                        doc.autoTable({
                            startY: finalY,
                            head: [[cat.nome, 'PRE√áO (R$)', 'CD', 'CONCORRENTE', 'R$ CONC.']],
                            body: linhasTabela,
                            theme: 'grid',
                            headStyles: { fillColor: [0, 76, 151], textColor: 255, fontStyle: 'bold' },
                            alternateRowStyles: { fillColor: [245, 248, 252] },
                            styles: { fontSize: 8, cellPadding: 3, textColor: [50, 50, 50] },
                            columnStyles: {
                                0: { fontStyle: 'bold', cellWidth: 45 },
                                1: { halign: 'right', cellWidth: 25 },
                                2: { halign: 'center', cellWidth: 20 },
                                3: { cellWidth: 55 },
                                4: { halign: 'right', cellWidth: 25 }
                            },
                            margin: { left: 14, right: 14 }
                        });
                        finalY = doc.lastAutoTable.finalY + 8; // Espa√ßo para a pr√≥xima tabela
                    }
                });

                if (!teveProduto) {
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'italic');
                    doc.text("Nenhum produto preenchido neste relat√≥rio.", 14, finalY);
                    finalY += 10;
                }

                // Observa√ß√µes
                const obs = document.getElementById('obs').value.trim();
                if (obs) {
                    if (finalY > doc.internal.pageSize.height - 30) {
                        doc.addPage();
                        finalY = 20;
                    }
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Observa√ß√µes:', 14, finalY);
                    
                    doc.setFont('helvetica', 'normal');
                    const splitObs = doc.splitTextToSize(obs, doc.internal.pageSize.width - 28);
                    doc.text(splitObs, 14, finalY + 6);
                }

                // Rodap√© com n√∫mero de p√°gina
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(7);
                    doc.setTextColor(150);
                    doc.text(
                        `P√°gina ${i} de ${pageCount}  |  Gerado via Sistema Interno`, 
                        doc.internal.pageSize.width / 2, 
                        doc.internal.pageSize.height - 10, 
                        { align: 'center' }
                    );
                }

                // Download Autom√°tico
                const nomeArquivo = revenda ? `Relatorio_${revenda.replace(/\s+/g, '_')}.pdf` : `Relatorio_Panasonic.pdf`;
                doc.save(nomeArquivo);
            }

            function copiarTexto() {
                const texto = gerarTextoCompleto();
                navigator.clipboard.writeText(texto).then(() => {
                    alert('‚úÖ Relat√≥rio copiado com sucesso! Voc√™ j√° pode colar no WhatsApp ou E-mail.');
                }).catch(() => {
                    alert('Erro ao copiar. Tente usar o bot√£o Enviar WhatsApp.');
                });
            }

            function abrirWhatsApp() {
                const texto = encodeURIComponent(gerarTextoCompleto());
                window.open(`https://api.whatsapp.com/send?text=${texto}`, '_blank');
            }

            window.addEventListener('DOMContentLoaded', () => {
                renderizarTabelas();
                preencherDataHoje();
                carregarConcorrentes();

                document.getElementById('salvarRascunho').addEventListener('click', salvarRascunho);
                document.getElementById('carregarRascunho').addEventListener('click', carregarRascunho);
                document.getElementById('gerarWhatsApp').addEventListener('click', abrirWhatsApp);
                document.getElementById('copiarTexto').addEventListener('click', copiarTexto);
                document.getElementById('gerarPDF').addEventListener('click', gerarPDF);

                // Scroll suave para as abas
                document.querySelectorAll('.tab-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const id = link.getAttribute('href').substring(1);
                        document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                });
            });

        })();
    </script>
</body>
</html>
